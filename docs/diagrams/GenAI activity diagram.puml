@startuml /interpret Endpoint Activity Diagram

skinparam monochrome false
skinparam defaultTextAlignment center
skinparam shadowing false
skinparam activity {
    BackgroundColor #F9F9F9
    BorderColor #333333
    FontSize 14
    FontColor black
}
skinparam arrow {
    Color #333333
    FontSize 13
}

start

:Receive POST /interpret;

:Ensure project embeddings are up to date;

if (Embeddings up to date?) then (Yes)
  :Continue;
else (No)
  :Fetch project and tasks from server;
  :Update vectorstore;
endif

:Classify prompt (Q&A vs Task Generation);

if (Prompt is Q&A?) then (Yes)
  :Retrieve relevant content;
  :Generate answer using QA model;
  :Return GenAIResponse with answer and existing tasks;
else (No)
  :Retrieve relevant content;
  :Generate context-aware answer;
  :Generate new task suggestions;
  :Return GenAIResponse with answer and new tasks;
endif

stop
@enduml
